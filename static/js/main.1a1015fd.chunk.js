(this.webpackJsonpime2=this.webpackJsonpime2||[]).push([[0],{142:function(t,e,i){"use strict";i.r(e);var n=i(12),a=i.n(n),s=i(58),r=i.n(s),o=(i(75),i(13)),c=i.n(o),h=i(14),u=i(0),l=i(1),d=i(7),g=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;return Math.round(t*Math.pow(10,e))/Math.pow(10,e)},f=function(){function t(){Object(u.a)(this,t),this.dict={},this.chunksDicts=void 0,this.borders=void 0,this.chunkSizes=[40,20,10,5],this.chunksDicts=this.chunkSizes.map((function(){return{}}));for(var e=-100;e<=0;e++)for(var i=-2;i<=2;i++)for(var n=-2;n<=2;n++)this.dict[this.getKeyFromPosition({x:i,y:n,z:e})]=1;for(var a=-103;a<=-100;a++)for(var s=-100;s<=100;s++)for(var r=-100;r<=100;r++)this.dict[this.getKeyFromPosition({x:s,y:r,z:a})]=1;for(var o=46;o<=50;o++)for(var c=50;c<=54;c++)this.dict[this.getKeyFromPosition({x:o,y:c,z:100})]=1;this.dict[this.getKeyFromPosition({x:49,y:55,z:100})]=1,this.dict[this.getKeyFromPosition({x:47,y:55,z:100})]=1,this.dict[this.getKeyFromPosition({x:49,y:56,z:100})]=1,this.dict[this.getKeyFromPosition({x:47,y:56,z:100})]=1,this.dict[this.getKeyFromPosition({x:48,y:56,z:100})]=1;var h=this.getPositionFromKey(Object.keys(this.dict)[0]);this.borders={xMin:h.x,xMax:h.x,yMin:h.y,yMax:h.y,zMin:h.z,zMax:h.z},this.setChunksAndBorders()}return Object(l.a)(t,[{key:"getKeyFromPosition",value:function(t){return JSON.stringify(t)}},{key:"getPositionFromKey",value:function(t){return JSON.parse(t)}},{key:"getChunkPosition",value:function(t,e){return{a:g((e.y-e.x)/t),b:g((e.y+e.x+e.z/3)/t),c:g(e.z/t)}}},{key:"getChunkKeyFromChunkPosition",value:function(t){return JSON.stringify({a:Math.floor(t.a),b:Math.floor(t.b),c:Math.floor(t.c)})}},{key:"getChunkKeyFromPosition",value:function(t,e){return this.getChunkKeyFromChunkPosition(this.getChunkPosition(t,e))}},{key:"getTileAt",value:function(t){return this.dict[this.getKeyFromPosition(t)]}},{key:"setTileAt",value:function(t,e){this.dict[this.getKeyFromPosition(t)]=e}},{key:"removeTileAt",value:function(t){delete this.dict[this.getKeyFromPosition(t)]}},{key:"setChunksAndBorders",value:function(){var t=this;Object.keys(this.dict).forEach((function(e){var i=t.getPositionFromKey(e);i.x<t.borders.xMin&&(t.borders.xMin=i.x),i.x>t.borders.xMax&&(t.borders.xMax=i.x),i.y<t.borders.yMin&&(t.borders.yMin=i.y),i.y>t.borders.yMax&&(t.borders.yMax=i.y),i.z<t.borders.zMin&&(t.borders.zMin=i.z),i.z>t.borders.zMax&&(t.borders.zMax=i.z),t.chunksDicts.forEach((function(e,n){e[t.getChunkKeyFromPosition(t.chunkSizes[n],i)]=!0}))}))}},{key:"_crossSectionIsEmpty",value:function(t,e,i,n){for(var a=this.getChunkPosition(e,i),s=this.getChunkPosition(e,n),r=Math.floor(a.a);r<=s.a;r++)for(var o=Math.floor(a.c);o<=s.c;o++)if(t[this.getChunkKeyFromChunkPosition({a:r,b:a.b,c:o})])return!1;return!0}},{key:"crossSectionIsEmpty",value:function(t,e){for(var i=Object(d.a)(Object(d.a)({},t),{},{z:Math.min(this.borders.zMax,Math.max(this.borders.zMin,t.z))}),n=Object(d.a)(Object(d.a)({},e),{},{z:Math.min(this.borders.zMax,Math.max(this.borders.zMin,e.z))}),a=0;a<this.chunksDicts.length;a++)if(!0===this._crossSectionIsEmpty(this.chunksDicts[a],this.chunkSizes[a],i,n))return!0;return!1}}]),t}(),v=i(18),b=i(4),m=i(67),x=-2.1,y=-2.9,P=-.26262,w=1e3,C=.05,p=function(){function t(e,i){Object(u.a)(this,t),this.canvas=e,this.tileMap=i,this.context=void 0,this.viewCone=void 0,this.framesDuration=Object(b.a)(Array(30)).fill(0),this.lastTime=0,this.frameIndex=0;var n=this.canvas.getContext("2d");if(!n)throw new Error("Context cannot be null");n.imageSmoothingEnabled=!1,this.context=n;var a={x:x,y:y,z:P},s=this.canvas.width,r=this.canvas.height,o=Math.pow(4,1),c=Math.pow(4,0),h={a1:-s/2/c,a2:s/2/c,b1:-r/2/c,b2:r/2/c};this.viewCone=new m.a(a,w,h,-500,i,o),this.lastTime=Date.now(),this.renderLoop(),this.init()}return Object(l.a)(t,[{key:"init",value:function(){var t=Object(h.a)(c.a.mark((function t(){return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return console.time("discover"),t.next=3,this.viewCone.discover(1500);case 3:return console.timeEnd("discover"),t.next=6,new Promise((function(t){return setTimeout(t,2e3)}));case 6:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"renderLoop",value:function(){var t=this,e=Date.now()-this.lastTime;this.lastTime=Date.now(),this.framesDuration.push(e),this.framesDuration.shift(),this.frameIndex++%30===0&&console.log(this.fps.toFixed(1)),this.paintCanvas(),x+=C+=0,y+=C,w+=0,(P-=C)<-100&&(C=-.1),P>2&&(C=.1),this.viewCone.move({x:x,y:y,z:P},w),requestAnimationFrame((function(){return t.renderLoop()}))}},{key:"paintCanvas",value:function(){this.viewCone.paintCanvas(),this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.context.drawImage(this.viewCone.canvas,0,0,this.canvas.width,this.canvas.height)}},{key:"fps",get:function(){return this.framesDuration.length/this.framesDuration.reduce((function(t,e){return t+e}),0)*1e3}}]),t}(),k=function(){function t(e){Object(u.a)(this,t),this.canvas=e}return Object(l.a)(t,[{key:"start",value:function(){var t=Object(h.a)(c.a.mark((function t(){var e,i,n,a;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=new v.a("tile1"),t.next=3,e.load();case 3:return i=new v.a("tile2"),t.next=6,i.load();case 6:return n=new v.a("mask"),t.next=9,n.load();case 9:a=new f,new p(this.canvas,a);case 11:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()}]),t}(),O=function(){var t=Object(n.useRef)(null);return Object(n.useEffect)((function(){t&&t.current&&new k(t.current).start()}),[t]),a.a.createElement(a.a.Fragment,null,a.a.createElement("canvas",{width:1600,height:800,ref:t,style:{border:"1px solid black",margin:"20px"}}))},j=function(){return a.a.createElement("div",null,a.a.createElement("p",null,"IME"),a.a.createElement(O,null))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));r.a.render(a.a.createElement(a.a.StrictMode,null,a.a.createElement(j,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(t){t.unregister()})).catch((function(t){console.error(t.message)}))},18:function(t,e,i){"use strict";i.d(e,"a",(function(){return u}));var n=i(13),a=i.n(n),s=i(14),r=i(0),o=i(1),c=i(33),h=new(i(32).a)(["name"]),u=function(){function t(e){Object(r.a)(this,t),this.name=e,this.url=void 0,this.imageJs=void 0,this.canvas=void 0,this._isLoaded=!1,this.url="".concat("","/").concat(e,".png"),h.addEntry(this)}return Object(o.a)(t,[{key:"isLoaded",value:function(){return this._isLoaded}},{key:"load",value:function(){var t=Object(s.a)(a.a.mark((function t(){var e;return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,c.a.load(this.url);case 2:e=t.sent,this.imageJs=e,this.canvas=this.imageJs.getCanvas(),this._isLoaded=!0;case 6:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()}],[{key:"getResource",value:function(t){return h.getEntry({name:t})}},{key:"getLoadedResource",value:function(t){var e=h.getEntry({name:t});if(e&&e.isLoaded())return e}}]),t}()},32:function(t,e,i){"use strict";i.d(e,"a",(function(){return s}));var n=i(0),a=i(1),s=function(){function t(e){Object(n.a)(this,t),this.idFields=e,this.dict={}}return Object(a.a)(t,[{key:"getId",value:function(t){var e={};return this.idFields.forEach((function(i){e[i]=t[i]})),JSON.stringify(e)}},{key:"addEntry",value:function(t){this.dict[this.getId(t)]=t}},{key:"getEntry",value:function(t){return this.dict[this.getId(t)]}}]),t}()},67:function(t,e,i){"use strict";(function(t){i.d(e,"a",(function(){return d}));var n=i(11),a=i(13),s=i.n(a),r=i(14),o=i(0),c=i(1),h=i(69),u=i(68),l=i.n(u),d=function(){function e(t,i,n,a,s,r){Object(o.a)(this,e),this.center=t,this.focal=i,this.rendererWindow=n,this.startDistanceFromCenter=a,this.tileMap=s,this.zoom=r,this.crossSections=[],this.maxDistanceFromCenter=void 0,this.sprites=[],this.canvas=void 0,this.context=void 0,this.recentering=!1,this.maxDistanceFromCenter=a-1;var c=this.newCanvasAndContext(),h=c.canvas,u=c.context;this.canvas=h,this.context=u}return Object(c.a)(e,[{key:"newCanvasAndContext",value:function(){var t=new OffscreenCanvas(this.width*this.zoom,this.height*this.zoom),e=t.getContext("2d");if(!e)throw new Error("Context cannot be null");return e.imageSmoothingEnabled=!1,{canvas:t,context:e}}},{key:"paintCanvas",value:function(){var t=this;this.context.clearRect(0,0,this.canvas.width,this.canvas.height),l.a.orderBy(this.crossSections,["buildingDistanceFromCenter"],["desc"]).forEach((function(e){var i=e.sprite;i&&t.context.drawImage(i.image,i.sx,i.sy,i.sw,i.sh,0,0,t.canvas.width,t.canvas.height)}))}},{key:"discover",value:function(){var e=Object(r.a)(s.a.mark((function e(i){var n,a,r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=this.maxDistanceFromCenter,a=n+1;case 2:if(!(a<=n+i)){e.next=13;break}return e.next=5,new Promise((function(e){return t(e)}));case 5:return e.next=7,new h.a(this.center,this.focal,this.window,a,this.tileMap);case 7:r=e.sent,this.crossSections.push(r),this.maxDistanceFromCenter=a-1;case 10:a++,e.next=2;break;case 13:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"move",value:function(t,e){var i;if(this.crossSections.forEach((function(n){n.move(t,e),n.sprite&&!i&&(i=n)})),i&&i.sprite){var n=1/4;(i.sprite.sx<i.margin.a*n||i.sprite.sy<i.margin.b*n||i.sprite.sx+i.sprite.sw>i.buildingParams.extendedWidth-i.margin.a*n||i.sprite.sy+i.sprite.sh>i.buildingParams.extendedHeight-i.margin.b*n)&&this.recenter()}}},{key:"recenter",value:function(){var e=Object(r.a)(s.a.mark((function e(){var i,a,r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.recentering){e.next=2;break}return e.abrupt("return");case 2:this.recentering=!0,i=Object(n.a)(this.crossSections),e.prev=4,i.s();case 6:if((a=i.n()).done){e.next=13;break}return r=a.value,e.next=10,new Promise((function(e){return t(e)}));case 10:r.recenter();case 11:e.next=6;break;case 13:e.next=18;break;case 15:e.prev=15,e.t0=e.catch(4),i.e(e.t0);case 18:return e.prev=18,i.f(),e.finish(18);case 21:this.recentering=!1;case 22:case"end":return e.stop()}}),e,this,[[4,15,18,21]])})));return function(){return e.apply(this,arguments)}}()},{key:"window",get:function(){return{a1:this.rendererWindow.a1/this.zoom,a2:this.rendererWindow.a2/this.zoom,b1:this.rendererWindow.b1/this.zoom,b2:this.rendererWindow.b2/this.zoom}}},{key:"width",get:function(){return this.window.a2-this.window.a1}},{key:"height",get:function(){return this.window.b2-this.window.b1}}]),e}()}).call(this,i(139).setImmediate)},69:function(t,e,i){"use strict";i.d(e,"a",(function(){return g}));var n,a=i(7),s=i(0),r=i(1),o=i(4),c=i(33),h=i(32),u=i(18),l=new h.a(["type","neighborhood"]);!function(t){t[t.FTL=64329]="FTL",t[t.LSL=63735]="LSL",t[t.LSB=10280]="LSB",t[t.LST=62509]="LST",t[t.FBL=65277]="FBL",t[t.LSR=57567]="LSR",t[t.FTR=53199]="FTR",t[t.FBR=0]="FBR",t[t.RSL=59623]="RSL",t[t.RSB=27296]="RSB",t[t.RST=16824]="RST",t[t.RSR=61807]="RSR"}(n||(n={}));var d=function(){function t(e,i){var n;Object(s.a)(this,t),this.type=e,this.neighborhood=i,this.imageJs=void 0,this.canvas=void 0,this.maskResource=void 0,this.tileResource=void 0;var a=u.a.getLoadedResource(e);if(!a)throw new Error("Resource '".concat(e,"' hasn't been loaded."));var r=u.a.getLoadedResource("mask");if(!r)throw new Error("Resource '".concat("mask","' hasn't been loaded."));this.tileResource=a,this.maskResource=r,this.imageJs=this.makeImageJs(),this.canvas=null===(n=this.imageJs)||void 0===n?void 0:n.getCanvas(),l.addEntry(this)}return Object(r.a)(t,[{key:"makeImageJs",value:function(){var t=this.neighborhood,e=t.above,i=t.topLeft,a=t.topRight,s=t.bottomLeft,r=t.bottomRight,h=t.under;if(!(e&&s&&r)){for(var u=this.tileResource.imageJs,l=this.maskResource.imageJs,d=new c.a(32,24,void 0,{bitDepth:16}),g=0;g<32;g++)for(var f=0;f<24;f++){d.setPixelXY(g,f,[0,0,0,0]);var v=l.getPixelXY(g,f);if(v[0]!==n.FTL)if(v[0]!==n.FTR)if(v[0]!==n.FBL)if(v[0]!==n.FBR)if(v[0]!==n.LSL)if(v[0]!==n.LST)if(v[0]!==n.LSB)if(v[0]!==n.LSR)if(v[0]!==n.RSR)if(v[0]!==n.RST)if(v[0]!==n.RSB)if(v[0]!==n.RSL);else{if(!0===r){if(!0===e)continue;d.setPixelXY(g,f,Object(o.a)(u.getPixelXY(g,f+24)));continue}if(!1===s){d.setPixelXY(g,f,Object(o.a)(u.getPixelXY(g,f)));continue}d.setPixelXY(g,f,Object(o.a)(u.getPixelXY(g,f+48)))}else{if(!0===r){if(!0===e)continue;d.setPixelXY(g,f,Object(o.a)(u.getPixelXY(g,f+24)));continue}if(!1===h){d.setPixelXY(g,f,Object(o.a)(u.getPixelXY(g,f)));continue}d.setPixelXY(g,f,Object(o.a)(u.getPixelXY(g,f+48)))}else{if(!0===r){if(!0===e)continue;d.setPixelXY(g,f,Object(o.a)(u.getPixelXY(g,f+24)));continue}if(!1===e){d.setPixelXY(g,f,Object(o.a)(u.getPixelXY(g,f)));continue}d.setPixelXY(g,f,Object(o.a)(u.getPixelXY(g,f+48)))}else{if(!0===r){if(!0===e)continue;d.setPixelXY(g,f,Object(o.a)(u.getPixelXY(g,f+24)));continue}if(!1===a){d.setPixelXY(g,f,Object(o.a)(u.getPixelXY(g,f)));continue}d.setPixelXY(g,f,Object(o.a)(u.getPixelXY(g,f+48)))}else{if(!0===s){if(!0===e)continue;d.setPixelXY(g,f,Object(o.a)(u.getPixelXY(g,f+24)));continue}if(!1===r){d.setPixelXY(g,f,Object(o.a)(u.getPixelXY(g,f)));continue}d.setPixelXY(g,f,Object(o.a)(u.getPixelXY(g,f+48)))}else{if(!0===s){if(!0===e)continue;d.setPixelXY(g,f,Object(o.a)(u.getPixelXY(g,f+24)));continue}if(!1===h){d.setPixelXY(g,f,Object(o.a)(u.getPixelXY(g,f)));continue}d.setPixelXY(g,f,Object(o.a)(u.getPixelXY(g,f+48)))}else{if(!0===s){if(!0===e)continue;d.setPixelXY(g,f,Object(o.a)(u.getPixelXY(g,f+24)));continue}if(!1===e){d.setPixelXY(g,f,Object(o.a)(u.getPixelXY(g,f)));continue}d.setPixelXY(g,f,Object(o.a)(u.getPixelXY(g,f+48)))}else{if(!0===s){if(!0===e)continue;d.setPixelXY(g,f,Object(o.a)(u.getPixelXY(g,f+24)));continue}if(!1===i){d.setPixelXY(g,f,Object(o.a)(u.getPixelXY(g,f)));continue}d.setPixelXY(g,f,Object(o.a)(u.getPixelXY(g,f+48)))}else{if(!0===e)continue;if(!1===r){d.setPixelXY(g,f,Object(o.a)(u.getPixelXY(g,f)));continue}d.setPixelXY(g,f,Object(o.a)(u.getPixelXY(g,f+24)))}else{if(!0===e)continue;if(!1===s){d.setPixelXY(g,f,Object(o.a)(u.getPixelXY(g,f)));continue}d.setPixelXY(g,f,Object(o.a)(u.getPixelXY(g,f+24)))}else{if(!0===e)continue;if(!1===a){d.setPixelXY(g,f,Object(o.a)(u.getPixelXY(g,f)));continue}d.setPixelXY(g,f,Object(o.a)(u.getPixelXY(g,f+24)))}else{if(!0===e)continue;if(!1===i){d.setPixelXY(g,f,Object(o.a)(u.getPixelXY(g,f)));continue}d.setPixelXY(g,f,Object(o.a)(u.getPixelXY(g,f+24)))}}return d}}}],[{key:"getTile",value:function(t,e){return l.getEntry({type:t,neighborhood:e})}},{key:"getOrMakeTile",value:function(e,i){var n=l.getEntry({type:e,neighborhood:i});return n||new t(e,i)}}]),t}(),g=function(){function t(e,i,n,a,r){var o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{a:160,b:80};Object(s.a)(this,t),this.focal=i,this.viewConeWindow=n,this.tileMap=r,this.margin=o,this.buildingDistanceFromCenter=void 0,this.actualDistanceFromCenter=void 0,this.buildingViewConeCenter=void 0,this.actualViewConeCenter=void 0,this.actualFocal=void 0,this.buildingFocal=void 0,this.actualParams=void 0,this.buildingParams=void 0,this.tilesDict=void 0,this.canvas=void 0,this.context=void 0,this.spriteCropParams=void 0,this.isRecentering=!1,this.buildingViewConeCenter={x:Math.round(e.x),y:Math.round(e.y),z:Math.round(e.z)},this.actualViewConeCenter=e;var c=t.getDistanceBetween(this.buildingViewConeCenter,e);this.buildingDistanceFromCenter=Math.round(a+c),this.actualDistanceFromCenter=Math.round(a),this.actualFocal=i,this.buildingFocal=i,this.actualParams=t.getCrossSectionParams(this.actualViewConeCenter,i,n,this.actualDistanceFromCenter,o),this.buildingParams=t.getCrossSectionParams(this.buildingViewConeCenter,i,n,this.buildingDistanceFromCenter,o),this.spriteCropParams=this.getSpriteCropParams(),this.tilesDict=this.makeTilesDict(),this.paintCanvas()}return Object(r.a)(t,[{key:"getSpriteCropParams",value:function(){var t=this.getCrossSectionPosition(this.actualParams.center),e=t.a,i=t.b;return{sx:this.margin.a+e+Math.round(this.buildingParams.extendedWidth/2)-this.actualParams.extendedWidth/2,sy:this.margin.b-i+Math.round(this.buildingParams.extendedHeight/2)-this.actualParams.extendedHeight/2,sw:this.actualParams.width,sh:this.actualParams.height}}},{key:"newCanvasAndContext",value:function(){var t=new OffscreenCanvas(this.buildingParams.extendedWidth,this.buildingParams.extendedHeight),e=t.getContext("2d");if(!e)throw new Error("Context cannot be null");return e.imageSmoothingEnabled=!1,{canvas:t,context:e}}},{key:"paintCanvas",value:function(){var t=this,e=this.tiles;if(0===e.length||e.every((function(t){return!t.tile.canvas})))this.context&&(delete this.context,delete this.canvas);else{if(!this.context){var i=this.newCanvasAndContext(),n=i.canvas,a=i.context;this.canvas=n,this.context=a}this.context.clearRect(0,0,this.buildingParams.extendedWidth,this.buildingParams.extendedHeight),e.forEach((function(e){var i=e.crossSectionPosition,n=i.a,a=i.b,s=e.tile;s.canvas&&t.context&&t.context.drawImage(s.canvas,Math.round(t.buildingParams.extendedWidth/2)+(n-16),Math.round(t.buildingParams.extendedHeight/2)+(-a-8),s.canvas.width,s.canvas.height)}))}}},{key:"getA",value:function(t){var e=t.x;return 16*(t.y-this.buildingParams.center.y-(e-this.buildingParams.center.x))}},{key:"getB",value:function(t){return 32/3*(t.z-this.buildingParams.center.z)}},{key:"getCrossSectionPosition",value:function(t){return{a:this.getA(t),b:this.getB(t)}}},{key:"getX",value:function(t){var e=t.a,i=t.b;return this.buildingParams.center.x-e/32-i/64}},{key:"getY",value:function(t){var e=t.a,i=t.b;return this.buildingParams.center.y+e/32-i/64}},{key:"getZ",value:function(t){var e=t.b;return this.buildingParams.center.z+3*e/32}},{key:"getPosition",value:function(t){return{x:this.getX(t),y:this.getY(t),z:this.getZ(t)}}},{key:"forEachTilePosition",value:function(e,i,n){var a=this.buildingParams.extendedWindow,s=a.a1,r=a.a2,o=a.b1,c=a.b2,h=this.buildingParams.heightConstraint,u=Math.ceil(this.getZ({b:o}));i&&i>u&&(u=i);var l=t.getHeightConstraint(u);l!==h&&(u+=t.getHeightConstraint(h-l));var d=Math.floor(this.getZ({b:c}));n&&n<d&&(d=n);var g=t.getHeightConstraint(d);g!==h&&(d-=t.getHeightConstraint(-h+g));for(var f=u;f<=d;f+=3)for(var v=this.getB({z:f}),b=Math.ceil(this.getY({a:s,b:v})),m=Math.floor(this.getY({a:r,b:v})),x=b;x<=m;x++){e({x:Math.round(this.buildingParams.crossSectionConstant-x-f/3),y:x,z:f})}}},{key:"makeTilesDict",value:function(){var e=this,i={},n=this.tileMap,s=this.buildingParams.extendedWindow,r=s.a1,o=s.a2,c=s.b1,h=s.b2;return n.crossSectionIsEmpty(this.getPosition({a:r,b:c}),this.getPosition({a:o,b:h}))||this.forEachTilePosition((function(s){var r=t.getTileId(s);if(n.getTileAt(s)){var o={above:1===n.getTileAt(Object(a.a)(Object(a.a)({},s),{},{z:s.z+1})),bottomLeft:1===n.getTileAt(Object(a.a)(Object(a.a)({},s),{},{x:s.x+1})),bottomRight:1===n.getTileAt(Object(a.a)(Object(a.a)({},s),{},{y:s.y+1})),topLeft:1===n.getTileAt(Object(a.a)(Object(a.a)({},s),{},{y:s.y-1})),topRight:1===n.getTileAt(Object(a.a)(Object(a.a)({},s),{},{x:s.x-1})),under:1===n.getTileAt(Object(a.a)(Object(a.a)({},s),{},{z:s.z-1}))},c=d.getOrMakeTile("tile2",o);i[r]={position:s,crossSectionPosition:e.getCrossSectionPosition(s),tile:c}}}),n.borders.zMin,n.borders.zMax),i}},{key:"move",value:function(e,i){var n=t.getDistanceBetween(e,this.actualViewConeCenter);this.actualDistanceFromCenter+=n,this.actualViewConeCenter=e,this.actualFocal=i,this.actualParams=t.getCrossSectionParams(e,i,this.viewConeWindow,this.actualDistanceFromCenter,this.margin),this.spriteCropParams=this.getSpriteCropParams();var a=this.spriteCropParams,s=a.sx,r=a.sy,o=a.sw,c=(a.sh,3/4);s<this.margin.a*c||r<this.margin.b*c||s+o>this.buildingParams.extendedWidth-this.margin.a*c||(this.buildingParams.extendedHeight,this.margin.b)}},{key:"recenter",value:function(){if(!this.isRecentering){this.isRecentering=!0;var e=new t(this.actualViewConeCenter,this.actualFocal,this.viewConeWindow,this.actualDistanceFromCenter,this.tileMap,this.margin);this.buildingViewConeCenter=e.buildingViewConeCenter,this.buildingDistanceFromCenter=e.buildingDistanceFromCenter,this.buildingParams=e.buildingParams,this.buildingFocal=e.buildingFocal,this.spriteCropParams=e.spriteCropParams,this.tilesDict=e.tilesDict,this.canvas=e.canvas,this.context=e.context,this.isRecentering=!1}}},{key:"sprite",get:function(){if(this.canvas){var t=this.spriteCropParams,e=t.sx,i=t.sy,n=t.sw,a=t.sh;return{image:this.canvas,sx:e,sy:i,sw:n,sh:a}}}},{key:"tiles",get:function(){return Object.values(this.tilesDict)}}],[{key:"getCrossSectionParams",value:function(e,i,n,a,s){var r={x:e.x-a/8,y:e.y-a/8,z:e.z-a/4},o=1+a/i,c={a1:n.a1*o,a2:n.a2*o,b1:n.b1*o,b2:n.b2*o},h=c.a2-c.a1,u=c.b2-c.b1,l={a1:c.a1-s.a,a2:c.a2+s.a,b1:c.b1-s.b,b2:c.b2+s.b};return{center:r,scale:o,window:c,width:h,height:u,extendedWindow:l,extendedWidth:l.a2-l.a1,extendedHeight:l.b2-l.b1,heightConstraint:t.getHeightConstraint(e.z-a),crossSectionConstant:t.getCrossSectionConstant(r)}}},{key:"getCrossSectionConstant",value:function(t){return t.x+t.y+t.z/3}},{key:"getDistanceBetween",value:function(e,i){return 3*(t.getCrossSectionConstant(e)-t.getCrossSectionConstant(i))}},{key:"getHeightConstraint",value:function(t){return(3+t%3)%3}},{key:"getTileId",value:function(t){return JSON.stringify(t)}}]),t}()},70:function(t,e,i){t.exports=i(142)},75:function(t,e,i){}},[[70,1,2]]]);
//# sourceMappingURL=main.1a1015fd.chunk.js.map