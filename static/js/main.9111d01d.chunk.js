(this.webpackJsonpime2=this.webpackJsonpime2||[]).push([[0],{134:function(t,e,i){"use strict";i.r(e);var n,s=i(11),o=i.n(s),r=i(56),a=i.n(r),c=(i(70),i(12)),h=i.n(c),u=i(10),l=i(16),f=i(0),g=i(1),b=i(5),d=i(23),m=function(){function t(e){var i=e.name,n=e.url,s=e.dataURL,o=e.imageJs,r=e.hTMLImageElement;if(Object(f.a)(this,t),this.name=void 0,this.url=void 0,this.dataURL=void 0,this.imageJs=void 0,this.hTMLImageElement=void 0,this._isLoaded=void 0,!n&&!s&&!o&&!r)throw new Error("Must at least specify one source for the image");this.name=i,this.url=n,this.dataURL=s,this.imageJs=o,this.hTMLImageElement=r,this._isLoaded=!1}return Object(g.a)(t,[{key:"load",value:function(){var t=Object(l.a)(h.a.mark((function t(){var e;return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this._isLoaded){t.next=2;break}return t.abrupt("return");case 2:if(!this.url||this.imageJs){t.next=6;break}return t.next=5,d.a.load(this.url);case 5:this.imageJs=t.sent;case 6:if(this.imageJs&&!this.dataURL&&(this.dataURL=this.imageJs.toDataURL()),!this.dataURL||this.imageJs){t.next=11;break}return t.next=10,d.a.load(this.dataURL);case 10:this.imageJs=t.sent;case 11:if(!this.dataURL||!this.imageJs||this.hTMLImageElement){t.next=17;break}return(e=new Image(this.imageJs.width,this.imageJs.height)).src=this.dataURL,t.next=16,new Promise((function(t){return e.onload=function(){return t()}}));case 16:this.hTMLImageElement=e;case 17:this._isLoaded=!0;case 18:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"isLoaded",get:function(){return this._isLoaded}}]),t}(),v=function(t){return t.isLoaded};!function(t){t[t.FTL=64329]="FTL",t[t.LSL=63735]="LSL",t[t.LSB=10280]="LSB",t[t.LST=62509]="LST",t[t.FBL=65277]="FBL",t[t.LSR=57567]="LSR",t[t.FTR=53199]="FTR",t[t.FBR=0]="FBR",t[t.RSL=59623]="RSL",t[t.RSB=27296]="RSB",t[t.RST=16824]="RST",t[t.RSR=61807]="RSR"}(n||(n={}));var x=function(t){var e=t.neighboors;return t.ressourceSpriteName+"-"+JSON.stringify(e)},P=function(t){for(var e=t.neighboors,i=t.ressourceSprite,s=t.maskSprite,o=e.above,r=e.topLeft,a=e.topRight,c=e.bottomLeft,h=e.bottomRight,u=e.under,l=i.imageJs,f=s.imageJs,g=new d.a(32,24,void 0,{bitDepth:16}),v=0;v<32;v++)for(var P=0;P<24;P++){g.setPixelXY(v,P,[0,0,0,0]);var y=f.getPixelXY(v,P);if(y[0]!==n.FTL)if(y[0]!==n.FTR)if(y[0]!==n.FBL)if(y[0]!==n.FBR)if(y[0]!==n.LSL)if(y[0]!==n.LST)if(y[0]!==n.LSB)if(y[0]!==n.LSR)if(y[0]!==n.RSR)if(y[0]!==n.RST)if(y[0]!==n.RSB)if(y[0]!==n.RSL);else{if(!0===h){if(!0===o)continue;g.setPixelXY(v,P,Object(b.a)(l.getPixelXY(v,P+24)));continue}if(!1===c){g.setPixelXY(v,P,Object(b.a)(l.getPixelXY(v,P)));continue}g.setPixelXY(v,P,Object(b.a)(l.getPixelXY(v,P+48)))}else{if(!0===h){if(!0===o)continue;g.setPixelXY(v,P,Object(b.a)(l.getPixelXY(v,P+24)));continue}if(!1===u){g.setPixelXY(v,P,Object(b.a)(l.getPixelXY(v,P)));continue}g.setPixelXY(v,P,Object(b.a)(l.getPixelXY(v,P+48)))}else{if(!0===h){if(!0===o)continue;g.setPixelXY(v,P,Object(b.a)(l.getPixelXY(v,P+24)));continue}if(!1===o){g.setPixelXY(v,P,Object(b.a)(l.getPixelXY(v,P)));continue}g.setPixelXY(v,P,Object(b.a)(l.getPixelXY(v,P+48)))}else{if(!0===h){if(!0===o)continue;g.setPixelXY(v,P,Object(b.a)(l.getPixelXY(v,P+24)));continue}if(!1===a){g.setPixelXY(v,P,Object(b.a)(l.getPixelXY(v,P)));continue}g.setPixelXY(v,P,Object(b.a)(l.getPixelXY(v,P+48)))}else{if(!0===c){if(!0===o)continue;g.setPixelXY(v,P,Object(b.a)(l.getPixelXY(v,P+24)));continue}if(!1===h){g.setPixelXY(v,P,Object(b.a)(l.getPixelXY(v,P)));continue}g.setPixelXY(v,P,Object(b.a)(l.getPixelXY(v,P+48)))}else{if(!0===c){if(!0===o)continue;g.setPixelXY(v,P,Object(b.a)(l.getPixelXY(v,P+24)));continue}if(!1===u){g.setPixelXY(v,P,Object(b.a)(l.getPixelXY(v,P)));continue}g.setPixelXY(v,P,Object(b.a)(l.getPixelXY(v,P+48)))}else{if(!0===c){if(!0===o)continue;g.setPixelXY(v,P,Object(b.a)(l.getPixelXY(v,P+24)));continue}if(!1===o){g.setPixelXY(v,P,Object(b.a)(l.getPixelXY(v,P)));continue}g.setPixelXY(v,P,Object(b.a)(l.getPixelXY(v,P+48)))}else{if(!0===c){if(!0===o)continue;g.setPixelXY(v,P,Object(b.a)(l.getPixelXY(v,P+24)));continue}if(!1===r){g.setPixelXY(v,P,Object(b.a)(l.getPixelXY(v,P)));continue}g.setPixelXY(v,P,Object(b.a)(l.getPixelXY(v,P+48)))}else{if(!0===o)continue;if(!1===h){g.setPixelXY(v,P,Object(b.a)(l.getPixelXY(v,P)));continue}g.setPixelXY(v,P,Object(b.a)(l.getPixelXY(v,P+24)))}else{if(!0===o)continue;if(!1===c){g.setPixelXY(v,P,Object(b.a)(l.getPixelXY(v,P)));continue}g.setPixelXY(v,P,Object(b.a)(l.getPixelXY(v,P+24)))}else{if(!0===o)continue;if(!1===a){g.setPixelXY(v,P,Object(b.a)(l.getPixelXY(v,P)));continue}g.setPixelXY(v,P,Object(b.a)(l.getPixelXY(v,P+24)))}else{if(!0===o)continue;if(!1===r){g.setPixelXY(v,P,Object(b.a)(l.getPixelXY(v,P)));continue}g.setPixelXY(v,P,Object(b.a)(l.getPixelXY(v,P+24)))}}return new m({name:x({neighboors:e,ressourceSpriteName:i.name}),imageJs:g})},y=function(){function t(){Object(f.a)(this,t),this.registry=void 0,this.registry={}}return Object(g.a)(t,[{key:"addSprite",value:function(t){if(this.registry[t.name])throw new Error("A sprite named '".concat(t.name,"' is already present in registry."));this.registry[t.name]=t}},{key:"getSprite",value:function(t){return this.registry[t]}},{key:"load",value:function(){var t=Object(l.a)(h.a.mark((function t(){return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.isLoaded){t.next=2;break}return t.abrupt("return");case 2:return t.next=4,Promise.all(Object.values(this.registry).map((function(t){return t.load()})));case 4:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"isLoaded",get:function(){return Object.values(this.registry).every((function(t){return t.isLoaded}))}}]),t}(),p=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;return Math.round(t*Math.pow(10,e))/Math.pow(10,e)},S=function(){function t(){Object(f.a)(this,t),this.dict={},this.chunksDicts=void 0,this.chunkSizes=[40,20,10,5],this.chunksDicts=this.chunkSizes.map((function(){return{}}));for(var e=-100;e<=0;e++)for(var i=-2;i<=2;i++)for(var n=-2;n<=2;n++)this.dict[this.getKeyFromPosition({x:i,y:n,z:e})]=1;for(var s=-100;s<=100;s++)for(var o=-100;o<=100;o++)this.dict[this.getKeyFromPosition({x:s,y:o,z:-100})]=1;for(var r=46;r<=50;r++)for(var a=50;a<=54;a++)this.dict[this.getKeyFromPosition({x:r,y:a,z:100})]=1;this.dict[this.getKeyFromPosition({x:49,y:55,z:100})]=1,this.dict[this.getKeyFromPosition({x:47,y:55,z:100})]=1,this.dict[this.getKeyFromPosition({x:49,y:56,z:100})]=1,this.dict[this.getKeyFromPosition({x:47,y:56,z:100})]=1,this.dict[this.getKeyFromPosition({x:48,y:56,z:100})]=1,this.setChunks()}return Object(g.a)(t,[{key:"getKeyFromPosition",value:function(t){return JSON.stringify(t)}},{key:"getPositionFromKey",value:function(t){return JSON.parse(t)}},{key:"getChunkPosition",value:function(t,e){return{a:p((e.y-e.x)/t),b:p((e.y+e.x+e.z/3)/t),c:p(e.z/t)}}},{key:"getChunkKeyFromChunkPosition",value:function(t){return JSON.stringify({a:Math.floor(t.a),b:Math.floor(t.b),c:Math.floor(t.c)})}},{key:"getChunkKeyFromPosition",value:function(t,e){return this.getChunkKeyFromChunkPosition(this.getChunkPosition(t,e))}},{key:"getTileAt",value:function(t){return this.dict[this.getKeyFromPosition(t)]}},{key:"setChunks",value:function(){var t=this;Object.keys(this.dict).forEach((function(e){var i=t.getPositionFromKey(e);t.chunksDicts.forEach((function(e,n){e[t.getChunkKeyFromPosition(t.chunkSizes[n],i)]=!0}))}))}},{key:"_crossSectionIsEmpty",value:function(t,e,i,n){for(var s=this.getChunkPosition(e,i),o=this.getChunkPosition(e,n),r=Math.floor(s.a);r<=o.a;r++)for(var a=Math.floor(s.c);a<=o.c;a++)if(t[this.getChunkKeyFromChunkPosition({a:r,b:s.b,c:a})])return!1;return!0}},{key:"crossSectionIsEmpty",value:function(t,e){for(var i=0;i<this.chunksDicts.length;i++)if(!0===this._crossSectionIsEmpty(this.chunksDicts[i],this.chunkSizes[i],t,e))return!0;return!1}}]),t}(),k=function(){function t(e,i,n,s){Object(f.a)(this,t),this.viewConeCenter=e,this.focal=i,this.viewConeWindow=n,this.distanceFromCenter=s,this.center=void 0,this.scale=void 0,this.window=void 0,this.extendedWindow=void 0,this.heightConstraint=void 0,this.crossSectionConstant=void 0,this._tilesDict={},this.center={x:e.x-s/8,y:e.y-s/8,z:e.z-s/4},this.scale=1+s/i,this.window={a1:n.a1*this.scale,a2:n.a2*this.scale,b1:n.b1*this.scale,b2:n.b2*this.scale};this.extendedWindow={a1:this.window.a1-1.999,a2:this.window.a2+1.999,b1:this.window.b1-.999,b2:this.window.b2+1.999},this.heightConstraint=t.getHeightConstraint(e.z-s),this.crossSectionConstant=this.center.x+this.center.y+this.center.z/3}return Object(g.a)(t,[{key:"getA",value:function(t){var e=t.y,i=t.z;return 4*(e-this.center.y+(i-this.center.z)/6)}},{key:"getB",value:function(t){return 4/3*(t-this.center.z)}},{key:"getCrossSectionPosition",value:function(t){return{a:this.getA(t),b:this.getB(t.z)}}},{key:"getProjetedCrossSectionPosition",value:function(t){return{a:this.getA(t)/this.scale,b:this.getB(t.z)/this.scale}}},{key:"getX",value:function(t){var e=t.a,i=t.b;return this.center.x-e/4-i/8}},{key:"getY",value:function(t){var e=t.a,i=t.b;return this.center.y+e/4-i/8}},{key:"getZ",value:function(t){return this.center.z+3*t/4}},{key:"getPosition",value:function(t){var e=t.a,i=t.b;return{x:this.getX({a:e,b:i}),y:this.getY({a:e,b:i}),z:this.getZ(i)}}},{key:"forEachTilePosition",value:function(t){for(var e=this.extendedWindow,i=e.a1,n=e.a2,s=this.zMin;s<=this.zMax;s+=3)for(var o=this.getB(s),r=Math.ceil(this.getY({a:i,b:o})),a=Math.floor(this.getY({a:n,b:o})),c=r;c<=a;c++){t({x:Math.round(this.crossSectionConstant-c-s/3),y:c,z:s})}}},{key:"setTilesFromMap",value:function(e){var i=this;this._tilesDict={};var n=this.extendedWindow,s=n.a1,o=n.a2,r=n.b1,a=n.b2;return e.crossSectionIsEmpty(this.getPosition({a:s,b:r}),this.getPosition({a:o,b:a}))||this.forEachTilePosition((function(n){var s=e.getTileAt(n);s&&(i._tilesDict[t.getTileId(n)]={position:n,crossSectionPosition:i.getCrossSectionPosition(n),projetedCrossSectionPosition:i.getProjetedCrossSectionPosition(n),scale:1/i.scale,value:s})})),this.tiles}},{key:"addTilesFromASubCrossSection",value:function(e){var i=this;e.forEach((function(e){i._tilesDict[t.getTileId(e.position)]=Object(u.a)(Object(u.a)({},e),{},{crossSectionPosition:i.getCrossSectionPosition(e.position),projetedCrossSectionPosition:i.getProjetedCrossSectionPosition(e.position)})}))}},{key:"zMin",get:function(){var e=this.extendedWindow.b1,i=this.heightConstraint,n=Math.ceil(this.getZ(e)),s=t.getHeightConstraint(n);return s!==i&&(n+=t.getHeightConstraint(i-s)),n}},{key:"zMax",get:function(){var e=this.extendedWindow.b2,i=this.heightConstraint,n=Math.floor(this.getZ(e)),s=t.getHeightConstraint(n);return s!==i&&(n-=t.getHeightConstraint(-i+s)),n}},{key:"tiles",get:function(){return Object.values(this._tilesDict)}}],[{key:"getHeightConstraint",value:function(t){return(3+t%3)%3}},{key:"getTileId",value:function(t){return JSON.stringify(t)}}]),t}(),w=i(19),j=i.n(w),O=function(){function t(e,i,n,s,o){Object(f.a)(this,t),this.center=e,this.focal=i,this.window=n,this.startDistanceFromCenter=s,this.endDistanceFromCenter=o,this._crossSectionsDict={}}return Object(g.a)(t,[{key:"setCrossSectionsFromMap",value:function(e){var i=this;this._crossSectionsDict={};for(var n,s=0,o=this.endDistanceFromCenter-this.startDistanceFromCenter;s<=o;){var r=new k(this.center,this.focal,this.window,this.startDistanceFromCenter+s);this._crossSectionsDict[this.startDistanceFromCenter+s]=r,r.setTilesFromMap(e).length>0&&(o=Math.min(o,s+3),n||(n=r)),s++}if(this.startDistanceFromCenter+s-1>=this.endDistanceFromCenter)return this.crossSections;if(!n)throw new Error("First non empty cross section cannot be undefined here");return this.getEmptyWindows(n).forEach((function(n){var o=new t(i.center,i.focal,n,i.startDistanceFromCenter+s,i.endDistanceFromCenter);o.setCrossSectionsFromMap(e),Object.keys(o.crossSectionsDict).forEach((function(t){var e=Number(t);i.crossSectionsDict[e]||(i.crossSectionsDict[e]=new k(i.center,i.focal,i.window,e)),i.crossSectionsDict[e].addTilesFromASubCrossSection(o.crossSectionsDict[e].tiles)}))})),this.crossSections}},{key:"getEmptyWindows",value:function(t){for(var e=p(1/t.scale),i=j.a.flatten(this.crossSections.map((function(t){return t.tiles}))),n=p(.1*e),s=this.window,o=i.map((function(t){return t.projetedCrossSectionPosition})),r=j.a.orderBy(o,["b","a"],["asc","asc"]),a={a:p(s.a1),b:p(s.b1)},c=p(2*e),h=p(1*e),u=[],l=function(t){p(t.a2-t.a1)<=n||p(t.b2-t.b1)<=n||u.push(t)};a.b<s.b2;){var f=r[0];if(!f){l({a1:a.a,a2:s.a2,b1:a.b,b2:s.b2});break}if(p(a.a-f.a)>=c||p(a.b-f.b)>=0)r.shift();else if(p(f.b-a.b)>h){var g=Math.min(s.b2,p(f.b-h));l({a1:a.a,a2:s.a2,b1:a.b,b2:g}),a.b=g}else{for(var b=f.b,d=Math.min(s.b2,p(b+0));a.a<s.a2;){if(!(f=r[0])||f.b!==b){l({a1:a.a,a2:s.a2,b1:a.b,b2:d});break}if(p(a.a-f.a)>=c||p(a.b-f.b)>=0)r.shift();else if(Math.abs(p(f.a-a.a))<=c)r.shift(),a.a=Math.min(s.a2,p(f.a+c));else{var m=Math.min(s.a2,p(f.a-c));l({a1:a.a,a2:m,b1:a.b,b2:d}),r.shift(),a.a=p(m+2*c)}}a.a=s.a1,a.b=d}}return u}},{key:"crossSectionsDict",get:function(){return this._crossSectionsDict}},{key:"crossSections",get:function(){return Object.values(this._crossSectionsDict)}}]),t}(),Y=function(){function t(e){Object(f.a)(this,t),this.canvas=e}return Object(g.a)(t,[{key:"start",value:function(){var t=Object(l.a)(h.a.mark((function t(){var e,i,n,s,o,r,a,c,l,f,g,b,d,p,k,j,Y,X,C,L,F;return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=new y,i=new m({name:"tile1",url:"/tile2.png"}),n=new m({name:"mask",url:"/mask.png"}),e.addSprite(i),e.addSprite(n),(s=this.canvas.getContext("2d")).imageSmoothingEnabled=!1,t.next=9,e.load();case 9:if(v(i)&&v(n)){t.next=11;break}throw new Error("load failed");case 11:for(o=Math.floor(this.canvas.width/2),r=Math.floor(this.canvas.height/2),a=16,c=function(t){return(t-o)/a+2},l=function(t){return-(t-r)/a-1},f=new S,g={x:-2,y:-2,z:0},d={a1:c(-2*a+(b=0)),a2:c(-2*a+this.canvas.width-b),b1:l(-a+this.canvas.height-b),b2:l(-a+b)},console.time("viewcone"),(p=new O(g,1e3,d,-900,1e3)).setCrossSectionsFromMap(f),console.timeEnd("viewcone"),k=w.orderBy(p.crossSections,["distanceFromCenter"],["asc"]),j=w.flatten(k.map((function(t){return t.tiles}))),console.time("buffering"),Y=[],X=j.length-1;X>=0;X--)C=j[X],L={above:1===f.getTileAt(Object(u.a)(Object(u.a)({},C.position),{},{z:C.position.z+1})),bottomLeft:1===f.getTileAt(Object(u.a)(Object(u.a)({},C.position),{},{x:C.position.x+1})),bottomRight:1===f.getTileAt(Object(u.a)(Object(u.a)({},C.position),{},{y:C.position.y+1})),topLeft:1===f.getTileAt(Object(u.a)(Object(u.a)({},C.position),{},{y:C.position.y-1})),topRight:1===f.getTileAt(Object(u.a)(Object(u.a)({},C.position),{},{x:C.position.x-1})),under:1===f.getTileAt(Object(u.a)(Object(u.a)({},C.position),{},{z:C.position.z-1}))},(F=e.getSprite(x({neighboors:L,ressourceSpriteName:i.name})))||(F=P({neighboors:L,ressourceSprite:i,maskSprite:n}),e.addSprite(F)),Y.push({sprite:F,screenPosition:{x:o+(C.projetedCrossSectionPosition.a-2)*a+2*a*(1-C.scale),y:r-(C.projetedCrossSectionPosition.b+1)*a+a*(1-C.scale)},size:C.scale});if(console.timeEnd("buffering"),console.time("loading"),e.isLoaded){t.next=34;break}return t.next=34,e.load();case 34:console.timeEnd("loading"),console.time("drawing"),Y.forEach((function(t){s.drawImage(t.sprite.hTMLImageElement,0,0,32,24,t.screenPosition.x,t.screenPosition.y,4*a*t.size,3*a*t.size)})),console.timeEnd("drawing"),s.beginPath(),s.rect(b,b,this.canvas.width-2*b,this.canvas.height-2*b),s.stroke();case 41:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()}]),t}(),X=function(){var t=Object(s.useRef)(null);return Object(s.useEffect)((function(){t&&t.current&&new Y(t.current).start()}),[t]),o.a.createElement(o.a.Fragment,null,o.a.createElement("canvas",{width:1600,height:800,ref:t,style:{border:"1px solid black",margin:"20px"}}))},C=function(){return o.a.createElement("div",null,o.a.createElement("p",null,"IME"),o.a.createElement(X,null))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));a.a.render(o.a.createElement(o.a.StrictMode,null,o.a.createElement(C,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(t){t.unregister()})).catch((function(t){console.error(t.message)}))},65:function(t,e,i){t.exports=i(134)},70:function(t,e,i){}},[[65,1,2]]]);
//# sourceMappingURL=main.9111d01d.chunk.js.map